
<h2>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–µ–∑–¥–æ–∫ –ï–∫–±–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç+</h2>

{% if use_real_api %}
<div class="alert alert-info">
    <strong>–†–µ–∂–∏–º —Ä–µ–∞–ª—å–Ω—ã—Ö API:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TomTom –¥–ª—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
</div>
{% else %}
<div class="alert alert-warning">
    <strong>–†–µ–∂–∏–º –∑–∞–≥–ª—É—à–µ–∫:</strong> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
</div>
{% endif %}

<form method="get" id="route-form">
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</button>
</form>

{% if error_message %}
<div class="alert alert-danger">{{ error_message }}</div>
{% endif %}

{% if geocoded_points %}
<div class="card mt-3">
    <div class="card-header">
        <strong>–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:</strong>
    </div>
    <div class="card-body">
        <p><strong>–û—Ç–∫—É–¥–∞:</strong> {{ geocoded_points.start.address }} 
        ({{ geocoded_points.start.lat|floatformat:4 }}, {{ geocoded_points.start.lon|floatformat:4 }})</p>
        <p><strong>–ö—É–¥–∞:</strong> {{ geocoded_points.end.address }}
        ({{ geocoded_points.end.lat|floatformat:4 }}, {{ geocoded_points.end.lon|floatformat:4 }})</p>
        <small class="text-muted">–ò—Å—Ç–æ—á–Ω–∏–∫: {{ geocoded_points.start.source }}</small>
    </div>
</div>
{% endif %}

{% if routes %}
<h3 class="mt-4">–ù–∞–π–¥–µ–Ω–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {{ routes|length }}</h3>

{% for route in routes %}
<div class="card mt-3">
    <div class="card-header d-flex justify-content-between">
        <span>
            <strong>–ú–∞—Ä—à—Ä—É—Ç {{ forloop.counter }}</strong>
            {% if route.source %}
                <span class="badge bg-secondary">{{ route.source }}</span>
            {% endif %}
        </span>
        <span class="badge bg-info">–í—Ä–µ–º—è: {{ route.adjusted_time }} –º–∏–Ω</span>
    </div>
    <div class="card-body">
        <p>
            <strong>–ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è:</strong> {{ route.adjusted_time }} –º–∏–Ω 
            (–±–∞–∑–æ–≤–æ–µ: {{ route.base_time }} –º–∏–Ω, –ø—Ä–æ–±–∫–∏: √ó{{ route.traffic_coef }})
        </p>
        <p><strong>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</strong> {{ route.total_distance }} –º</p>
        
        {% if route.traffic_delay %}
        <div class="alert alert-warning">
            <strong>–ó–∞–¥–µ—Ä–∂–∫–∞ –∏–∑-–∑–∞ –ø—Ä–æ–±–æ–∫:</strong> {{ route.traffic_delay }} –º–∏–Ω
        </div>
        {% endif %}
        
        <h5>–≠—Ç–∞–ø—ã –º–∞—Ä—à—Ä—É—Ç–∞:</h5>
        <ul class="list-group">
            {% for segment in route.segments %}
            <li class="list-group-item">
                {% if segment.type == 'walk' %}
                    <span class="badge bg-success">üö∂ –ü–µ—à–∫–æ–º</span>
                    {{ segment.time }} –º–∏–Ω
                    <small class="text-muted">‚Äì {{ segment.details.text }}</small>
                {% elif segment.type == 'transport' %}
                    <span class="badge bg-primary">üöå –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
                    {{ segment.time }} –º–∏–Ω
                    <small class="text-muted">
                        ‚Äì {{ segment.details.route_name }}
                        {% if segment.details.transport_type %}
                            ({{ segment.details.transport_type }})
                        {% endif %}
                        {% if segment.details.traffic_info %}
                            <br>{{ segment.details.traffic_info }}
                        {% endif %}
                    </small>
                {% elif segment.type == 'car' %}
                    <span class="badge bg-warning">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</span>
                    {{ segment.time }} –º–∏–Ω
                    <small class="text-muted">
                        ‚Äì {{ segment.details.route_name }}
                        {% if segment.details.distance %}
                            ({{ segment.details.distance }})
                        {% endif %}
                        {% if segment.details.traffic_info %}
                            <br>{{ segment.details.traffic_info }}
                        {% endif %}
                    </small>
                {% else %}
                    <span class="badge bg-secondary">{{ segment.type }}</span>
                    {{ segment.time }} –º–∏–Ω
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endfor %}
{% endif %}


<script>
document.addEventListener('DOMContentLoaded', function() {
    const startInput = document.getElementById('start-point');
    const endInput = document.getElementById('end-point');
    
    function setupAutocomplete(input) {
        input.addEventListener('input', function(e) {
            const query = e.target.value;
            if (query.length < 2) return;
            
            fetch(`/api/autocomplete/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Autocomplete results:', data);
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫
                })
                .catch(error => console.error('Autocomplete error:', error));
        });
    }
    
    if (startInput) setupAutocomplete(startInput);
    if (endInput) setupAutocomplete(endInput);
});
</script>